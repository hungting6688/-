name: Enhanced Taiwan Stock Bot

on:
  schedule:
    # å°ç£æ™‚é–“ = UTC + 8
    - cron: '0 1 * * 1-5'    # 09:00 æ—©ç›¤æƒæ
    - cron: '30 2 * * 1-5'   # 10:30 ç›¤ä¸­æƒæ
    - cron: '30 4 * * 1-5'   # 12:30 åˆé–“æƒæ
    - cron: '0 7 * * 1-5'    # 15:00 ç›¤å¾Œæƒæ
    - cron: '0 9 * * 5'      # 17:00 é€±æœ«ç¸½çµï¼ˆåƒ…é€±äº”ï¼‰
  
  workflow_dispatch:
    inputs:
      run_type:
        description: 'é‹è¡Œé¡å‹'
        required: true
        default: 'morning_scan'
        type: choice
        options:
          - morning_scan
          - mid_morning_scan
          - mid_day_scan
          - afternoon_scan
          - weekly_summary

jobs:
  stock-analysis:
    runs-on: ubuntu-latest
    timeout-minutes: 15  # 15åˆ†é˜ç¸½è¶…æ™‚
    
    steps:
    - name: æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v4
      
    - name: å»ºç«‹å¿…è¦ç›®éŒ„
      run: |
        mkdir -p logs cache data
        mkdir -p data/analysis_results
        mkdir -p logs/notifications
        
    - name: è¨­ç½® Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
        
    - name: å®‰è£æ ¸å¿ƒä¾è³´
      run: |
        pip install --upgrade pip
        pip install requests pandas numpy python-dotenv pytz schedule beautifulsoup4 lxml
        
    # æ–°å¢ï¼šèªæ³•æª¢æŸ¥æ­¥é©Ÿ
    - name: æª¢æŸ¥èªæ³•
      run: |
        echo "ğŸ” æª¢æŸ¥ Python èªæ³•..."
        
        # æª¢æŸ¥ä¸»è¦æª”æ¡ˆ
        python -m py_compile enhanced_stock_bot.py || { echo "âŒ enhanced_stock_bot.py èªæ³•éŒ¯èª¤"; exit 1; }
        python -m py_compile notifier.py || { echo "âŒ notifier.py èªæ³•éŒ¯èª¤"; exit 1; }
        python -m py_compile twse_data_fetcher.py || { echo "âŒ twse_data_fetcher.py èªæ³•éŒ¯èª¤"; exit 1; }
        python -m py_compile config.py || { echo "âŒ config.py èªæ³•éŒ¯èª¤"; exit 1; }
        
        # æª¢æŸ¥å…¶ä»–é‡è¦æª”æ¡ˆï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        [ -f report_generator.py ] && python -m py_compile report_generator.py || true
        [ -f text_formatter.py ] && python -m py_compile text_formatter.py || true
        [ -f stock_analyzers.py ] && python -m py_compile stock_analyzers.py || true
        
        echo "âœ… æ‰€æœ‰æª”æ¡ˆèªæ³•æª¢æŸ¥é€šéï¼"
        
    - name: åŸ·è¡Œè‚¡ç¥¨åˆ†æ
      timeout-minutes: 12
      env:
        EMAIL_SENDER: ${{ secrets.EMAIL_SENDER }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        EMAIL_RECEIVER: ${{ secrets.EMAIL_RECEIVER }}
        EMAIL_SMTP_SERVER: ${{ secrets.EMAIL_SMTP_SERVER || 'smtp.gmail.com' }}
        EMAIL_SMTP_PORT: ${{ secrets.EMAIL_SMTP_PORT || '587' }}
        EMAIL_USE_TLS: ${{ secrets.EMAIL_USE_TLS || 'True' }}
      run: |
        RUN_TYPE="${{ github.event.inputs.run_type || 'morning_scan' }}"
        
        # ... å¾ŒçºŒåŸ·è¡Œé‚è¼¯ ...
